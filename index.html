<!DOCTYPE html>
<html>
<head>
    <title>Card Peel Effect</title>
    <link rel="stylesheet" href="peel.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            background: url('bg.jpg') center/cover;
            display: flex;
            flex-direction: column;
        }

        .card-container {
            flex-grow: 1;
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 50px;
        }

        .peel {
            width: 337.5px;
            height: 472.5px;
            border-radius: 12px;
        }
        
        .peel-top {
            background: url('card-back.png') center/cover;
            border-radius: 12px;
        }
        
        .peel-back {
            background: url('card-front.png') center/cover;
            border-radius: 12px;
        }
        
        .peel-bottom {
            background: transparent;
            border-radius: 12px;
        }
    </style>
</head>
<body>
    <div class="card-container">
        <div id="peelElement" class="peel"></div>
    </div>

    <script src="peel.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var element = document.getElementById('peelElement');
            var peel = new Peel(element, {
                corner: Peel.Corners.BOTTOM_LEFT,
                // mode: 'book',
                // topShadow: false,
                // backShadow: false,
                // bottomShadow: false,
                // backReflection: false
            });

            let currentX, currentY;
            let startX, startY;
            let adjustedX, adjustedY
            let startedDrag;
            let animationFrame;

            peel.handlePress(function(evt, x, y) {
            // Store and log the initial click position
            startX = x;
            startY = y;
            console.log('Click position:', { x: startX, y: startY });
        }, document.body);  // Using document.body as the hit area

            // Add drag handling
            peel.handleDrag(function(evt, x, y) {
                if (!startedDrag) {
                    startX = x;
                    startY = y;
                    startedDrag = true;
                }
                currentX = x;
                currentY = y;
                adjustedX =  currentX - startX;
                adjustedY = currentY - startY;
                console.log(0+adjustedX, 470+adjustedY);
                this.setPeelPosition(0+adjustedX, 470+adjustedY);
            });

            // Add release handling
            function animate() {
                // Calculate distance to move this frame (from adjusted position back to 0)
                let dx = (0 - adjustedX) * 0.15;
                let dy = (0 - adjustedY) * 0.15;
                
                // Update adjusted positions
                adjustedX += dx;
                adjustedY += dy;
                
                // Apply the new position relative to corner
                peel.setPeelPosition(0+adjustedX, 470+adjustedY);
                
                // Continue animation if not close enough to corner
                if (Math.abs(dx) > 0.5 || Math.abs(dy) > 0.5) {
                    animationFrame = requestAnimationFrame(animate);
                } else {
                    // Snap to exact corner position at end
                    peel.setPeelPosition(peel.corner);
                }
            }

            // Start animation on release
            document.addEventListener('mouseup', function() {
                startedDrag = false;
                if (animationFrame) {
                    cancelAnimationFrame(animationFrame);
                }
                animationFrame = requestAnimationFrame(animate);
            });
            
            // Handle touch devices
            document.addEventListener('touchend', function() {
                if (animationFrame) {
                    cancelAnimationFrame(animationFrame);
                }
                animationFrame = requestAnimationFrame(animate);
            });
        });
    </script>
</body>
</html>

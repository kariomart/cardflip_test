<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Card Peel Effect</title>
    <link rel="stylesheet" href="peel.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: url('bg.jpg') center/cover;
            display: flex;
            flex-direction: column;
        }

        .card-container {
            flex-grow: 1;
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: min(50px, 8vh);
            touch-action: none;
        }

        .peel {
            width: min(300px, 65vw);
            height: min(420px, 91vw);
            border-radius: min(16px, 3.5vw);
        }
        
        .peel-top {
            background: url('card-back.png') center/cover;
            border-radius: min(16px, 3.5vw);
        }
        
        .peel-back {
            background: url('card-front.png') center/cover;
            border-radius: min(16px, 3.5vw);
        }
        
        .peel-bottom {
            background: transparent;
            border-radius: min(16px, 3.5vw);
        }

        * {
            -webkit-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body>
    <div class="card-container">
        <div id="peelElement" class="peel"></div>
    </div>

    <script src="peel.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var element = document.getElementById('peelElement');
            var peel = new Peel(element, {
                corner: Peel.Corners.BOTTOM_LEFT,
                // mode: 'book',
                // topShadow: false,
                // backShadow: false,
                // bottomShadow: false,
                // backReflection: false
            });

            let currentX, currentY;
            let animationFrame;

            // Add drag handling
            peel.handleDrag(function(evt, x, y) {
                currentX = x;
                currentY = y;
                this.setPeelPosition(x, y);
            });

            // Add release handling
            function animate() {
                // Calculate distance to move this frame
                let dx = (peel.corner.x - currentX) * 0.15;
                let dy = (peel.corner.y - currentY) * 0.15;
                
                // Update current position
                currentX += dx;
                currentY += dy;
                
                // Apply the new position
                peel.setPeelPosition(currentX, currentY);
                
                // Continue animation if not close enough to corner
                if (Math.abs(dx) > 0.5 || Math.abs(dy) > 0.5) {
                    animationFrame = requestAnimationFrame(animate);
                } else {
                    // Snap to exact corner position at end
                    peel.setPeelPosition(peel.corner);
                }
            }

            // Start animation on release
            document.addEventListener('mouseup', function() {
                if (animationFrame) {
                    cancelAnimationFrame(animationFrame);
                }
                animationFrame = requestAnimationFrame(animate);
            });
            
            // Handle touch devices
            document.addEventListener('touchend', function() {
                if (animationFrame) {
                    cancelAnimationFrame(animationFrame);
                }
                animationFrame = requestAnimationFrame(animate);
            });
        });
    </script>
</body>
</html>
